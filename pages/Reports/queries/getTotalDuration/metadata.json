{
  "gitSyncId": "682f21b17162c93551de171a_884506d3-1ea0-4db2-8d0d-a2327995c82a",
  "id": "Reports_getTotalDuration",
  "pluginId": "mssql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "-- Declare input parameters\nDECLARE \n @ClientsList VARCHAR(8000) = '{{ ClientsMultiSelect.selectedOptionValues.join(\",\") }}',\n    @usersList VARCHAR(8000) = '{{ attorneyDropDownList.selectedOptionValue || \"\" }}',\n    @GroupsList VARCHAR(8000) = '',\n    @MattersList VARCHAR(8000) = '{{ MattersMultiSelect.selectedOptionValues.join(\",\") }}',\n    @ActivitiesList VARCHAR(8000) = '',\n    @ClientStatus INT = NULL,\n    @TimeSheetStatus INT = {{ timeSheetStatus.selectedOptionValue || 'NULL' }},\n    @BillingStatus INT = {{ BillingStatus.selectedOptionValue || 'NULL' }},\n    @MatterStatus INT = NULL,\n    @dateFrom NVARCHAR(50) = '{{ Checkbox1.isChecked ? \"\" : Input_TimeSheetDate.selectedDate }}',\n    @dateTo NVARCHAR(50) = '{{ Checkbox1.isChecked ? \"\" : DateTo.selectedDate }}',\n    @PaymentType INT = NULL;\n\n-- Split comma-separated lists using your existing function\nWITH \nClientSplitTbl AS (\n    SELECT value FROM dbo.fn_Split(@ClientsList, ',') WHERE value <> ''\n),\nUserSplitTbl AS (\n    SELECT value FROM dbo.fn_Split(@usersList, ',') WHERE value <> ''\n),\nGroupSplitTbl AS (\n    SELECT value FROM dbo.fn_Split(@GroupsList, ',') WHERE value <> ''\n),\nMatterSplitTbl AS (\n    SELECT value FROM dbo.fn_Split(@MattersList, ',') WHERE value <> ''\n),\nActivitySplitTbl AS (\n    SELECT value FROM dbo.fn_Split(@ActivitiesList, ',') WHERE value <> ''\n)\n\n-- Summary Result\nSELECT \n    SUM(CAST(ISNULL(TimeSheet_TimeDuration, '0') AS NUMERIC(18, 2))) AS TotalDuration,\n    MAX(ISNULL(ClientRatings.ClientRatings_DailyRating, 0)) AS DailyRating,\n    MAX(ISNULL(ClientRatings.ClientRatings_HourlyRating, 0)) AS HourlyRating,\n    SUM(CAST(ISNULL(ClientRatings_DailyRating, 0) AS NUMERIC(18, 2))) + \n    SUM(CAST(ISNULL(ClientRatings_HourlyRating, 0) AS NUMERIC(18, 2))) AS TotalRating,\n    SUM(CAST(ISNULL(TimeSheet_TimeDuration, '0') AS NUMERIC(18, 2)) * \n        (CAST(ISNULL(ClientRatings_DailyRating, 0) AS NUMERIC(18, 2)) + \n         CAST(ISNULL(ClientRatings_HourlyRating, 0) AS NUMERIC(18, 2)))) AS TotalAmount\n\nFROM TimeSheet\nLEFT JOIN Clients ON TimeSheet.TimeSheet_Clients_ID = Clients.ID \nLEFT JOIN Matters ON TimeSheet.TimeSheet_Matters_ID = Matters.ID \nLEFT JOIN Activities ON TimeSheet.TimeSheet_Activity_ID = Activities.ID \nLEFT JOIN Users ON TimeSheet.TimeSheet_Users_ID = Users.ID \nLEFT JOIN ClientGroups ON TimeSheet.TimeSheet_Clients_ID = ClientGroups.ClientGroups_Clients_ID \nLEFT JOIN ClientRatings ON \n    TimeSheet.TimeSheet_Clients_ID = ClientRatings_Clients_ID AND \n    TimeSheet.TimeSheet_Users_ID = ClientRatings_Users_ID\nWHERE\n    (TimeSheet.TimeSheet_Clients_ID IN (SELECT value FROM ClientSplitTbl) OR @ClientsList = '') AND\n    (TimeSheet.TimeSheet_Matters_ID IN (SELECT value FROM MatterSplitTbl) OR @MattersList = '') AND\n    (TimeSheet.TimeSheet_Activity_ID IN (SELECT value FROM ActivitySplitTbl) OR @ActivitiesList = '') AND\n    (ClientGroups.ClientGroups_Groups_ID IN (SELECT value FROM GroupSplitTbl) OR @GroupsList = '') AND\n    (TimeSheet.TimeSheet_Users_ID IN (SELECT value FROM UserSplitTbl) OR @usersList = '') AND\n    (TimeSheet.TimeSheet_Date >= TRY_CAST(@dateFrom AS DATETIME) OR @dateFrom = '') AND\n    (TimeSheet.TimeSheet_Date <= TRY_CAST(@dateTo AS DATETIME) OR @dateTo = '') AND\n    TimeSheet.TimeSheet_Active = 1 AND\n    Clients.Clients_ClientActive = 1 AND\n    (TimeSheet_TimeSheetStatuses_ID = @TimeSheetStatus OR @TimeSheetStatus IS NULL) AND\n    (TimeSheet_BillingStatuses_ID = @BillingStatus OR @BillingStatus IS NULL) AND\n    (Matters.Matters_MatterStatuses_ID = @MatterStatus OR @MatterStatus IS NULL) AND\n    (Clients.Clients_ClientStatuses_ID = @ClientStatus OR @ClientStatus IS NULL) AND\n    (Clients.Clients_PaymentsType_ID = @PaymentType OR @PaymentType IS NULL);\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Law Project DB",
      "isAutoGenerated": false,
      "name": "Law Project DB",
      "pluginId": "mssql-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "getTotalDuration",
    "pageId": "Reports",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}